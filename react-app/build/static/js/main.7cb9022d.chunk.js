(this["webpackJsonpreact-app"]=this["webpackJsonpreact-app"]||[]).push([[0],{35:function(e,t,a){e.exports=a.p+"static/media/north-west-gate.1fb9d39e.jpg"},36:function(e,t,a){e.exports=a.p+"static/media/north-east-gate.54300b9a.jpg"},37:function(e,t,a){e.exports=a.p+"static/media/north-gate.a2e473f2.jpg"},38:function(e,t,a){e.exports=a.p+"static/media/west-gate.7e955c33.jpg"},39:function(e,t,a){e.exports=a.p+"static/media/central-gate.f33b04f9.jpg"},40:function(e,t,a){e.exports=a.p+"static/media/east-gate.7b6ef059.jpg"},41:function(e,t,a){e.exports=a.p+"static/media/south-west-gate.ff6decff.jpg"},42:function(e,t,a){e.exports=a.p+"static/media/south-gate.25ae3350.jpg"},43:function(e,t,a){e.exports=a.p+"static/media/south-east-gate.04dfecff.jpg"},44:function(e,t,a){e.exports=a.p+"static/media/full-map.a7fcd8c7.jpg"},45:function(e,t,a){e.exports=a(87)},50:function(e,t,a){},51:function(e,t,a){},52:function(e,t,a){},81:function(e,t){},84:function(e,t,a){},85:function(e,t,a){},86:function(e,t,a){},87:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),s=a(33),i=a.n(s),c=(a(50),a(2)),r=a(3),l=a(5),u=a(4),m=a(1),g=a(6),h=(a(51),function(){function e(t){Object(c.a)(this,e),this.componentName="string"===typeof t?t:t.constructor.name}return Object(r.a)(e,[{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];t.splice(0,0,"-"),t.splice(0,0,this.componentName),console.log.apply(console,t)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];t.splice(0,0,"-"),t.splice(0,0,this.componentName),console.error.apply(console,t)}}]),e}()),p=function(e){return o.a.createElement("img",{alt:e.alt,src:e.src,onLoad:function(t){return e.onImageLoad(t.target)}})},d=(a(52),function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).logger=new h("MapLayer"),a.r1=30,a.r2=100,a.density=.4,a.overlay="rgba( 0, 0, 0, 1 )",a.baseMapImage=null,a.onMouseMove=a.onMouseMove.bind(Object(m.a)(a)),a.onMouseDown=a.onMouseDown.bind(Object(m.a)(a)),a.onMouseUp=a.onMouseUp.bind(Object(m.a)(a)),a.getDataImage=a.getDataImage.bind(Object(m.a)(a)),a.onImageLoad=a.onImageLoad.bind(Object(m.a)(a)),a.restoreFog=a.restoreFog.bind(Object(m.a)(a)),a.sendImage=a.sendImage.bind(Object(m.a)(a)),a}return Object(g.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.contextFog=this.canvasFog.getContext("2d"),this.canvasFog.addEventListener("touchstart",(function(t){(function(e,t){var a=e.getBoundingClientRect();return{x:t.touches[0].clientX-a.left,y:t.touches[0].clientY-a.top}})(e.canvasFog,t);var a=t.touches[0],n=new MouseEvent("mousedown",{clientX:a.clientX,clientY:a.clientY});e.onMouseDown(n)}),!1),this.canvasFog.addEventListener("touchend",(function(t){var a=new MouseEvent("mouseup",{});e.onMouseUp(a)}),!1),this.canvasFog.addEventListener("touchmove",(function(t){var a=t.touches[0],n=new MouseEvent("mousemove",{clientX:a.clientX,clientY:a.clientY});e.onMouseMove(n)}),!1)}},{key:"initContextMap",value:function(){var e=this.canvasFog,t=e.width,a=e.height;this.logger.log("Initializing Fog...",t,a),this.contextFog.fillStyle=this.overlay,this.contextFog.fillRect(0,0,t,a),this.contextFog.globalCompositeOperation="destination-out",this.restoreCanvas=document.createElement("canvas"),this.restoreCanvas.width=t,this.restoreCanvas.height=a,this.restoreContext=this.restoreCanvas.getContext("2d"),this.restoreContext.drawImage(this.canvasFog,0,0)}},{key:"restoreFog",value:function(){this.contextFog.globalCompositeOperation="source-over",this.contextFog.drawImage(this.restoreCanvas,0,0),this.contextFog.globalCompositeOperation="destination-out"}},{key:"sendImage",value:function(){var e=this.getDataImage();this.props.socket.emit("upload",e)}},{key:"onMouseDown",value:function(e){e.preventDefault(),this.isRemoveFog=!0}},{key:"onMouseUp",value:function(e){e.preventDefault(),this.isRemoveFog=!1}},{key:"onMouseMove",value:function(e){if(e.preventDefault(),this.isRemoveFog){var t=e.pageX,a=e.pageY;this.contextFog.fillStyle=this.getMapRadialGradient(t,a),this.contextFog.fillRect(t-this.r2,a-this.r2,2*this.r2,2*this.r2)}}},{key:"getMapRadialGradient",value:function(e,t){var a=this.contextFog.createRadialGradient(e,t,this.r1,e,t,this.r2);return a.addColorStop(0,"rgba( 0, 0, 0,  1 )"),a.addColorStop(this.density,"rgba( 0, 0, 0, .1 )"),a.addColorStop(1,"rgba( 0, 0, 0,  0 )"),a}},{key:"getDataImage",value:function(){var e=document.createElement("canvas");e.width=this.canvasFog.width,e.height=this.canvasFog.height;var t=e.getContext("2d");return t.drawImage(this.baseMapImage,0,0,this.baseMapImage.width,this.baseMapImage.height,0,0,this.canvasFog.width,this.canvasFog.height),t.drawImage(this.canvasFog,0,0),this.restoreContext.drawImage(e,0,0),e.toDataURL("image/png")}},{key:"onImageLoad",value:function(e){this.baseMapImage=e;var t=e.width,a=e.height;this.canvasFog.width=t,this.canvasFog.height=a,this.initContextMap()}},{key:"render",value:function(){var e=this,t=this.props,a=t.image,n=t.alt;return o.a.createElement("div",{className:"map-layer"},o.a.createElement(p,{alt:n,src:a,onImageLoad:this.onImageLoad}),o.a.createElement("canvas",{id:"canvas-fog",ref:function(t){return e.canvasFog=t},onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseMove:this.onMouseMove}),o.a.createElement("div",{className:"actions"},o.a.createElement("span",null,n),o.a.createElement("button",{onClick:this.restoreFog},"Cancel"),o.a.createElement("button",{onClick:this.sendImage},"Send")))}}]),t}(n.Component)),v=a(34),f=a.n(v),b=(a(84),function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).logger=new h("Login"),a.state={username:"",password:""},a.onSubmit=a.onSubmit.bind(Object(m.a)(a)),a.logout=a.logout.bind(Object(m.a)(a)),a}return Object(g.a)(t,e),Object(r.a)(t,[{key:"onSubmit",value:function(e){var t=this;e.preventDefault(),this.logger.log("Submitting login...",this.state),fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.state)}).then((function(e){return 200===e.status?e.text():""})).then((function(e){e={type:e,id:t.state.username},t.logger.log(e),t.props.onLoginSuccess&&t.props.onLoginSuccess(e)}))}},{key:"logout",value:function(e){this.logger.log("Logging out"),this.props.onLogoutSuccess&&this.props.onLogoutSuccess()}},{key:"render",value:function(){var e=this,t=this.state,a=t.username,n=t.password;return this.props.user?o.a.createElement("div",{className:"component-login user-login"},o.a.createElement("button",{onClick:this.logout},"Logout")):o.a.createElement("div",{className:"component-login user-logout"},o.a.createElement("form",{onSubmit:this.onSubmit},o.a.createElement("label",null,o.a.createElement("input",{placeholder:"Username",value:a,onChange:function(t){return e.setState({username:t.target.value})}})),o.a.createElement("label",null,o.a.createElement("input",{placeholder:"Password",value:n,onChange:function(t){return e.setState({password:t.target.value})}})),o.a.createElement("input",{type:"submit",value:"Login"})))}}]),t}(n.Component)),E=a(35),y=a.n(E),k=a(36),M=a.n(k),j=a(37),S=a.n(j),w=a(38),O=a.n(w),N=a(39),I=a.n(N),C=a(40),F=a.n(C),x=a(41),L=a.n(x),D=a(42),G=a.n(D),R=a(43),U=a.n(R),A=a(44),X=a.n(A),Y=(a(85),function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).fullMap={alt:"Full Map",src:X.a},a.list=[{alt:"North West Gate",src:y.a},{alt:"North Gate",src:S.a},{alt:"North Est Gate",src:M.a},{alt:"West Gate",src:O.a},{alt:"Central Gate",src:I.a},{alt:"Est Gate",src:F.a},{alt:"South West Gate",src:L.a},{alt:"South Gate",src:G.a},{alt:"South East Gate",src:U.a}],a}return Object(g.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"map-list"},o.a.createElement("ul",null,this.list.map((function(t,a){return o.a.createElement("li",{key:a,onClick:function(){return e.props.onMapSelected(t)}},o.a.createElement("img",{id:"map-".concat(a),alt:t.alt,src:t.src}))}))),o.a.createElement("img",{alt:this.fullMap.alt,src:this.fullMap.src}))}}]),t}(n.Component)),J=function(){function e(){Object(c.a)(this,e)}return Object(r.a)(e,null,[{key:"getItem",value:function(e){return this.contains(e)?JSON.parse(this.store.getItem(e)):null}},{key:"save",value:function(e,t){this.store.setItem(e,JSON.stringify(t))}},{key:"remove",value:function(e){this.store.removeItem(e)}},{key:"contains",value:function(e){return this.store.hasOwnProperty(e)}},{key:"storage",set:function(e){this.store=e},get:function(){return this.store}}]),e}();J.store=sessionStorage;a(86);var W=function(){return o.a.createElement("div",{className:"spinner"},o.a.createElement("div",{className:"container"},o.a.createElement("div",{className:"campfire-wrapper"},o.a.createElement("div",{className:"tree-container-back"},o.a.createElement("div",{className:"tree-8"}),o.a.createElement("div",{className:"tree-9"}),o.a.createElement("div",{className:"tree-10"})),o.a.createElement("div",{className:"rock-container"},o.a.createElement("div",{className:"rock-big"}),o.a.createElement("div",{className:"rock-small"},o.a.createElement("div",{className:"rock-1"}),o.a.createElement("div",{className:"rock-2"}),o.a.createElement("div",{className:"rock-3"}),o.a.createElement("div",{className:"rock-4"}))),o.a.createElement("div",{className:"smoke-container"},o.a.createElement("svg",null,o.a.createElement("path",{d:"M 150 0 Q 200 100 100 250 C 0 450 120 400 50 600  "})),o.a.createElement("div",{className:"fire-container"},o.a.createElement("div",{className:"flame-1"}),o.a.createElement("div",{className:"flame-2"}),o.a.createElement("div",{className:"flame-3"}))),o.a.createElement("div",{className:"tree-container-front"},o.a.createElement("div",{className:"tree-1"}),o.a.createElement("div",{className:"tree-2"}),o.a.createElement("div",{className:"tree-3"}),o.a.createElement("div",{className:"tree-4"}),o.a.createElement("div",{className:"tree-5"}),o.a.createElement("div",{className:"tree-6"}),o.a.createElement("div",{className:"tree-7"})))))},B=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).logger=new h("App"),a.state={sourceImage:null,sourceAlt:null,image:null,remote:null,user:J.getItem("user")},a.socket=f.a.connect(),a.onLoginSuccess=a.onLoginSuccess.bind(Object(m.a)(a)),a.onLogoutSuccess=a.onLogoutSuccess.bind(Object(m.a)(a)),a.onMapSelected=a.onMapSelected.bind(Object(m.a)(a)),a}return Object(g.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.socket.on("image",(function(t){e.logger.log("Received remote image..."),e.setState({remoteImage:t})})),this.socket.on("join",(function(t){e.logger.log("User joined the room",t)}))}},{key:"onLoginSuccess",value:function(e){J.save("user",e),this.socket.emit("login",e),this.setState({user:e})}},{key:"onLogoutSuccess",value:function(){J.remove("user"),this.setState({user:null})}},{key:"onMapSelected",value:function(e){this.setState({sourceImage:e.src,sourceAlt:e.alt})}},{key:"render",value:function(){var e=this.state,t=e.sourceImage,a=e.sourceAlt,n=e.remoteImage,s=e.user;return this.logger.log("User data",s),o.a.createElement("div",{className:"App"},o.a.createElement(b,{user:s,onLoginSuccess:this.onLoginSuccess,onLogoutSuccess:this.onLogoutSuccess}),s&&"master"===s.type?o.a.createElement("div",{className:"master-tools"},t?o.a.createElement(d,{image:t,alt:a,socket:this.socket}):null,o.a.createElement(Y,{onMapSelected:this.onMapSelected})):null,s&&"player"===s.type?n?o.a.createElement("img",{alt:"Loading map...",src:n}):o.a.createElement(W,null):null)}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(B,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[45,1,2]]]);
//# sourceMappingURL=main.7cb9022d.chunk.js.map