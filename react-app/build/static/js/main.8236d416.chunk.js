(this["webpackJsonpreact-app"]=this["webpackJsonpreact-app"]||[]).push([[0],{35:function(e,t,n){e.exports=n.p+"static/media/north-west-gate.1fb9d39e.jpg"},36:function(e,t,n){e.exports=n.p+"static/media/north-east-gate.54300b9a.jpg"},37:function(e,t,n){e.exports=n.p+"static/media/north-gate.a2e473f2.jpg"},38:function(e,t,n){e.exports=n.p+"static/media/west-gate.7e955c33.jpg"},39:function(e,t,n){e.exports=n.p+"static/media/central-gate.f33b04f9.jpg"},40:function(e,t,n){e.exports=n.p+"static/media/east-gate.7b6ef059.jpg"},41:function(e,t,n){e.exports=n.p+"static/media/south-west-gate.7e955c33.jpg"},42:function(e,t,n){e.exports=n.p+"static/media/south-gate.25ae3350.jpg"},43:function(e,t,n){e.exports=n.p+"static/media/south-east-gate.04dfecff.jpg"},44:function(e,t,n){e.exports=n(82)},49:function(e,t,n){},50:function(e,t,n){},79:function(e,t){},82:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),s=n(33),i=n.n(s),c=(n(49),n(2)),r=n(3),u=n(5),l=n(4),g=n(1),h=n(6),m=(n(50),function(){function e(t){Object(c.a)(this,e),this.componentName="string"===typeof t?t:t.constructor.name}return Object(r.a)(e,[{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.splice(0,0,"-"),t.splice(0,0,this.componentName),console.log.apply(console,t)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.splice(0,0,"-"),t.splice(0,0,this.componentName),console.error.apply(console,t)}}]),e}()),p=function(e){return o.a.createElement("img",{alt:e.alt,src:e.src,onLoad:function(t){return e.onImageLoad(t.target)}})},v=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).logger=new m("MapLayer"),n.r1=50,n.r2=150,n.density=.4,n.overlay="rgba( 0, 0, 0, 1 )",n.baseMapImage=null,n.onMouseMove=n.onMouseMove.bind(Object(g.a)(n)),n.onMouseDown=n.onMouseDown.bind(Object(g.a)(n)),n.onMouseUp=n.onMouseUp.bind(Object(g.a)(n)),n.getDataImage=n.getDataImage.bind(Object(g.a)(n)),n.onImageLoad=n.onImageLoad.bind(Object(g.a)(n)),n}return Object(h.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.contextFog=this.canvasFog.getContext("2d"),this.canvasFog.addEventListener("touchstart",(function(t){(function(e,t){var n=e.getBoundingClientRect();return{x:t.touches[0].clientX-n.left,y:t.touches[0].clientY-n.top}})(e.canvasFog,t);var n=t.touches[0],a=new MouseEvent("mousedown",{clientX:n.clientX,clientY:n.clientY});e.onMouseDown(a)}),!1),this.canvasFog.addEventListener("touchend",(function(t){var n=new MouseEvent("mouseup",{});e.onMouseUp(n)}),!1),this.canvasFog.addEventListener("touchmove",(function(t){var n=t.touches[0],a=new MouseEvent("mousemove",{clientX:n.clientX,clientY:n.clientY});e.onMouseMove(a)}),!1)}},{key:"initContextMap",value:function(){var e=this.canvasFog,t=e.width,n=e.height;this.logger.log("Initializing Fog...",t,n),this.contextFog.fillStyle=this.overlay,this.contextFog.fillRect(0,0,t,n),this.contextFog.globalCompositeOperation="destination-out"}},{key:"onMouseDown",value:function(e){e.preventDefault(),this.isRemoveFog=!0}},{key:"onMouseUp",value:function(e){e.preventDefault(),this.isRemoveFog=!1;var t=this.getDataImage();this.logger.log(t),this.props.socket.emit("upload",t)}},{key:"getDataImage",value:function(){var e=document.createElement("canvas");e.width=this.canvasFog.width,e.height=this.canvasFog.height;var t=e.getContext("2d");return t.drawImage(this.baseMapImage,0,0),t.drawImage(this.canvasFog,0,0),e.toDataURL("image/png")}},{key:"onMouseMove",value:function(e){if(e.preventDefault(),this.isRemoveFog){var t=e.pageX,n=e.pageY;this.contextFog.fillStyle=this.getMapRadialGradient(t,n),this.contextFog.fillRect(t-this.r2,n-this.r2,2*this.r2,2*this.r2)}}},{key:"getMapRadialGradient",value:function(e,t){var n=this.contextFog.createRadialGradient(e,t,this.r1,e,t,this.r2);return n.addColorStop(0,"rgba( 0, 0, 0,  1 )"),n.addColorStop(this.density,"rgba( 0, 0, 0, .1 )"),n.addColorStop(1,"rgba( 0, 0, 0,  0 )"),n}},{key:"onImageLoad",value:function(e){this.baseMapImage=e;var t=e.width,n=e.height;this.canvasFog.width=t,this.canvasFog.height=n,this.initContextMap()}},{key:"render",value:function(){var e=this,t=this.props.image;return o.a.createElement("div",{className:"map"},o.a.createElement(p,{alt:"Baldur's Gate",src:t,onImageLoad:this.onImageLoad}),o.a.createElement("canvas",{id:"canvas-fog",ref:function(t){return e.canvasFog=t},onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseMove:this.onMouseMove}))}}]),t}(a.Component),d=n(34),f=n.n(d),b=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).logger=new m("Login"),n.state={username:"",password:""},n.onSubmit=n.onSubmit.bind(Object(g.a)(n)),n.logout=n.logout.bind(Object(g.a)(n)),n}return Object(h.a)(t,e),Object(r.a)(t,[{key:"onSubmit",value:function(e){var t=this;e.preventDefault(),this.logger.log("Submitting login...",this.state),fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.state)}).then((function(e){return 200===e.status?e.text():""})).then((function(e){t.logger.log(e),t.props.onLoginSuccess&&t.props.onLoginSuccess(e)}))}},{key:"logout",value:function(e){this.logger.log("Logging out"),this.props.onLogoutSuccess&&this.props.onLogoutSuccess()}},{key:"render",value:function(){var e=this,t=this.state,n=t.username,a=t.password;return this.props.auth?o.a.createElement("div",{className:"component-login user-login"},o.a.createElement("button",{onClick:this.logout},"Logout")):o.a.createElement("div",{className:"component-login user-logout"},o.a.createElement("form",{onSubmit:this.onSubmit},o.a.createElement("label",null,o.a.createElement("input",{placeholder:"Username",value:n,onChange:function(t){return e.setState({username:t.target.value})}})),o.a.createElement("label",null,o.a.createElement("input",{placeholder:"Password",value:a,onChange:function(t){return e.setState({password:t.target.value})}})),o.a.createElement("input",{type:"submit",value:"Login"})))}}]),t}(a.Component),y=n(35),j=n.n(y),M=n(36),S=n.n(M),w=n(37),O=n.n(w),k=n(38),E=n.n(k),L=n(39),I=n.n(L),x=n(40),F=n.n(x),C=n(41),D=n.n(C),G=n(42),N=n.n(G),R=n(43),U=n.n(R),X=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).list=[{alt:"North West Gate",src:j.a},{alt:"North Gate",src:O.a},{alt:"North Est Gate",src:S.a},{alt:"Est Gate",src:F.a},{alt:"Central Gate",src:I.a},{alt:"West Gate",src:E.a},{alt:"South West Gate",src:D.a},{alt:"South Gate",src:N.a},{alt:"South East Gate",src:U.a}],n}return Object(h.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement("ul",null,this.list.map((function(t,n){return o.a.createElement("li",{key:n,onClick:function(){return e.props.onMapSelected(t)}},o.a.createElement("img",{id:"map-".concat(n),alt:t.alt,src:t.src}))})))}}]),t}(a.Component),Y=function(){function e(){Object(c.a)(this,e)}return Object(r.a)(e,null,[{key:"getItem",value:function(e){return this.store.getItem(e)}},{key:"save",value:function(e,t){this.store.setItem(e,t)}},{key:"remove",value:function(e){this.store.removeItem(e)}},{key:"contains",value:function(e){return this.store.hasOwnProperty(e)}},{key:"storage",set:function(e){this.store=e},get:function(){return this.store}}]),e}();Y.store=sessionStorage;var W=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).logger=new m("App"),n.state={sourceImage:null,image:null,remote:null,auth:Y.getItem("auth")},n.socket=f.a.connect(),n.onLoginSuccess=n.onLoginSuccess.bind(Object(g.a)(n)),n.onLogoutSuccess=n.onLogoutSuccess.bind(Object(g.a)(n)),n.onMapSelected=n.onMapSelected.bind(Object(g.a)(n)),n}return Object(h.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.socket.on("image",(function(t){e.logger.log("Received event 'image'",t),e.setState({remoteImage:t})}))}},{key:"onLoginSuccess",value:function(e){Y.save("auth",e),this.setState({auth:e})}},{key:"onLogoutSuccess",value:function(){Y.remove("auth"),this.setState({auth:null})}},{key:"onMapSelected",value:function(e){this.setState({sourceImage:e.src})}},{key:"render",value:function(){var e=this.state,t=e.sourceImage,n=e.remoteImage,a=e.auth;return o.a.createElement("div",{className:"App"},o.a.createElement(b,{auth:a,onLoginSuccess:this.onLoginSuccess,onLogoutSuccess:this.onLogoutSuccess}),"master"===a?o.a.createElement("div",{className:"master-tools"},t?o.a.createElement(v,{image:t,socket:this.socket}):null,o.a.createElement(X,{onMapSelected:this.onMapSelected})):null,"player"===a?o.a.createElement("img",{alt:"Loading map...",src:n}):null)}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(W,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[44,1,2]]]);
//# sourceMappingURL=main.8236d416.chunk.js.map