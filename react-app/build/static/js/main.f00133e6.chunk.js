(this["webpackJsonpreact-app"]=this["webpackJsonpreact-app"]||[]).push([[0],{35:function(e,t,a){e.exports=a.p+"static/media/north-west-gate.1fb9d39e.jpg"},36:function(e,t,a){e.exports=a.p+"static/media/north-east-gate.54300b9a.jpg"},37:function(e,t,a){e.exports=a.p+"static/media/north-gate.a2e473f2.jpg"},38:function(e,t,a){e.exports=a.p+"static/media/west-gate.7e955c33.jpg"},39:function(e,t,a){e.exports=a.p+"static/media/central-gate.f33b04f9.jpg"},40:function(e,t,a){e.exports=a.p+"static/media/east-gate.7b6ef059.jpg"},41:function(e,t,a){e.exports=a.p+"static/media/south-west-gate.ff6decff.jpg"},42:function(e,t,a){e.exports=a.p+"static/media/south-gate.25ae3350.jpg"},43:function(e,t,a){e.exports=a.p+"static/media/south-east-gate.04dfecff.jpg"},44:function(e,t,a){e.exports=a.p+"static/media/full-map.a7fcd8c7.jpg"},45:function(e,t,a){e.exports=a(89)},50:function(e,t,a){},51:function(e,t,a){},52:function(e,t,a){},81:function(e,t){},84:function(e,t,a){},85:function(e,t,a){},86:function(e,t,a){},87:function(e,t,a){},88:function(e,t,a){},89:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),s=a(33),r=a.n(s),i=(a(50),a(2)),c=a(3),l=a(5),u=a(4),m=a(1),h=a(6),g=(a(51),function(){function e(t){Object(i.a)(this,e),this.componentName="string"===typeof t?t:t.constructor.name}return Object(c.a)(e,[{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];t.splice(0,0,"-"),t.splice(0,0,this.componentName),console.log.apply(console,t)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];t.splice(0,0,"-"),t.splice(0,0,this.componentName),console.error.apply(console,t)}}]),e}()),d=function(e){return o.a.createElement("img",{alt:e.alt,src:e.src,onLoad:function(t){return e.onImageLoad(t.target)}})},v=(a(52),function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).logger=new g("MapLayer"),a.r1=30,a.r2=100,a.density=.4,a.overlay="rgba( 0, 0, 0, 1 )",a.baseMapImage=null,a.onMouseMove=a.onMouseMove.bind(Object(m.a)(a)),a.onMouseDown=a.onMouseDown.bind(Object(m.a)(a)),a.onMouseUp=a.onMouseUp.bind(Object(m.a)(a)),a.getDataImage=a.getDataImage.bind(Object(m.a)(a)),a.onImageLoad=a.onImageLoad.bind(Object(m.a)(a)),a.restoreFog=a.restoreFog.bind(Object(m.a)(a)),a.sendImage=a.sendImage.bind(Object(m.a)(a)),a.showMap=a.showMap.bind(Object(m.a)(a)),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.contextFog=this.canvasFog.getContext("2d"),this.canvasFog.addEventListener("touchstart",(function(t){(function(e,t){var a=e.getBoundingClientRect(),n=a.left,o=a.top,s=t.touches[0],r=s.clientX,i=s.clientY;return{x:r-n,y:i-o}})(e.canvasFog,t);var a=t.touches[0],n=a.clientX,o=a.clientY,s=new MouseEvent("mousedown",{clientX:n,clientY:o});e.onMouseDown(s)}),!1),this.canvasFog.addEventListener("touchend",(function(t){var a=new MouseEvent("mouseup",{});e.onMouseUp(a)}),!1),this.canvasFog.addEventListener("touchmove",(function(t){var a=t.touches[0],n=a.clientX,o=a.clientY,s=new MouseEvent("mousemove",{clientX:n,clientY:o});e.onMouseMove(s)}),!1)}},{key:"initContextMap",value:function(){var e=this.canvasFog,t=e.width,a=e.height;this.logger.log("Initializing Fog...",t,a),this.contextFog.fillStyle=this.overlay,this.contextFog.fillRect(0,0,t,a),this.contextFog.globalCompositeOperation="destination-out",this.restoreCanvas=document.createElement("canvas"),this.restoreCanvas.width=t,this.restoreCanvas.height=a,this.restoreContext=this.restoreCanvas.getContext("2d"),this.restoreContext.drawImage(this.canvasFog,0,0)}},{key:"restoreFog",value:function(){this.contextFog.globalCompositeOperation="source-over",this.contextFog.drawImage(this.restoreCanvas,0,0),this.contextFog.globalCompositeOperation="destination-out"}},{key:"sendImage",value:function(){var e=this.getDataImage();this.props.onSendImage&&this.props.onSendImage(e)}},{key:"showMap",value:function(){var e=this.canvasFog,t=e.width,a=e.height;this.contextFog.fillStyle=this.overlay,this.contextFog.fillRect(0,0,t,a)}},{key:"onMouseDown",value:function(e){e.preventDefault(),this.isRemoveFog=!0}},{key:"onMouseUp",value:function(e){e.preventDefault(),this.isRemoveFog=!1}},{key:"onMouseMove",value:function(e){if(e.preventDefault(),this.isRemoveFog){var t=e.clientX,a=e.clientY-this.r2;this.contextFog.fillStyle=this.getMapRadialGradient(t,a),this.contextFog.fillRect(t-this.r2,a-this.r2,2*this.r2,2*this.r2)}}},{key:"getMapRadialGradient",value:function(e,t){var a=this.contextFog.createRadialGradient(e,t,this.r1,e,t,this.r2);return a.addColorStop(0,"rgba( 0, 0, 0,  1 )"),a.addColorStop(this.density,"rgba( 0, 0, 0, .1 )"),a.addColorStop(1,"rgba( 0, 0, 0,  0 )"),a}},{key:"getDataImage",value:function(e){var t=document.createElement("canvas");t.width=this.canvasFog.width,t.height=this.canvasFog.height;var a=t.getContext("2d");return a.drawImage(this.baseMapImage,0,0,this.baseMapImage.width,this.baseMapImage.height,0,0,this.canvasFog.width,this.canvasFog.height),e||a.drawImage(this.canvasFog,0,0),this.restoreContext.drawImage(t,0,0),t.toDataURL("image/png")}},{key:"onImageLoad",value:function(e){this.baseMapImage=e;var t=e.width,a=e.height;this.canvasFog.width=t,this.canvasFog.height=a,this.initContextMap()}},{key:"render",value:function(){var e=this,t=this.props,a=t.image,n=t.alt;return o.a.createElement("div",{className:"map-layer"},o.a.createElement("div",{className:"actions",ref:function(t){return e.actions=t}},o.a.createElement("span",null,n),o.a.createElement("button",{onClick:this.restoreFog},"Cancel"),o.a.createElement("button",{onClick:this.sendImage},"Send"),o.a.createElement("button",{onClick:this.showMap},"Show Map")),o.a.createElement("div",{className:"map-container"},o.a.createElement(d,{alt:n,src:a,onImageLoad:this.onImageLoad}),o.a.createElement("canvas",{id:"canvas-fog",ref:function(t){return e.canvasFog=t},onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseMove:this.onMouseMove})))}}]),t}(n.Component)),p=a(34),f=a.n(p),b=(a(84),function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).logger=new g("Login"),a.state={username:"",password:""},a.onSubmit=a.onSubmit.bind(Object(m.a)(a)),a.logout=a.logout.bind(Object(m.a)(a)),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onSubmit",value:function(e){var t=this;e.preventDefault(),this.logger.log("Submitting login...",this.state),fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.state)}).then((function(e){return 200===e.status?e.text():""})).then((function(e){e={type:e,id:t.state.username},t.logger.log(e),t.props.onLoginSuccess&&t.props.onLoginSuccess(e)}))}},{key:"logout",value:function(e){this.logger.log("Logging out"),this.props.onLogoutSuccess&&this.props.onLogoutSuccess()}},{key:"render",value:function(){var e=this,t=this.state,a=t.username,n=t.password;return this.props.user?o.a.createElement("div",{className:"component-login user-login"},o.a.createElement("button",{onClick:this.logout},"Logout")):o.a.createElement("div",{className:"component-login user-logout"},o.a.createElement("form",{onSubmit:this.onSubmit},o.a.createElement("label",null,o.a.createElement("input",{placeholder:"Username",value:a,onChange:function(t){return e.setState({username:t.target.value})}})),o.a.createElement("label",null,o.a.createElement("input",{placeholder:"Password",value:n,onChange:function(t){return e.setState({password:t.target.value})}})),o.a.createElement("input",{type:"submit",value:"Login"})))}}]),t}(n.Component)),E=a(35),C=a.n(E),k=a(36),w=a.n(k),y=a(37),j=a.n(y),I=a(38),O=a.n(I),S=a(39),N=a.n(S),M=a(40),x=a.n(M),F=a(41),L=a.n(F),D=a(42),R=a.n(D),Y=a(43),X=a.n(Y),U=a(44),G=a.n(U),W=(a(85),function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).fullMap={alt:"Full Map",src:G.a},a.list=[{alt:"North West Gate",src:C.a},{alt:"North Gate",src:j.a},{alt:"North Est Gate",src:w.a},{alt:"West Gate",src:O.a},{alt:"Central Gate",src:N.a},{alt:"Est Gate",src:x.a},{alt:"South West Gate",src:L.a},{alt:"South Gate",src:R.a},{alt:"South East Gate",src:X.a}],a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"map-list"},o.a.createElement("ul",null,this.list.map((function(t,a){return o.a.createElement("li",{key:a,onClick:function(){return e.props.onMapSelected(t)}},o.a.createElement("img",{id:"map-".concat(a),alt:t.alt,src:t.src}))}))),o.a.createElement("img",{alt:this.fullMap.alt,src:this.fullMap.src}))}}]),t}(n.Component)),T=function(){function e(){Object(i.a)(this,e)}return Object(c.a)(e,null,[{key:"getItem",value:function(e){return this.contains(e)?JSON.parse(this.store.getItem(e)):null}},{key:"save",value:function(e,t){this.store.setItem(e,JSON.stringify(t))}},{key:"remove",value:function(e){this.store.removeItem(e)}},{key:"contains",value:function(e){return this.store.hasOwnProperty(e)}},{key:"storage",set:function(e){this.store=e},get:function(){return this.store}}]),e}();T.store=sessionStorage;a(86);var A=function(){return o.a.createElement("div",{className:"spinner"},o.a.createElement("div",{className:"container"},o.a.createElement("div",{className:"campfire-wrapper"},o.a.createElement("div",{className:"tree-container-back"},o.a.createElement("div",{className:"tree-8"}),o.a.createElement("div",{className:"tree-9"}),o.a.createElement("div",{className:"tree-10"})),o.a.createElement("div",{className:"rock-container"},o.a.createElement("div",{className:"rock-big"}),o.a.createElement("div",{className:"rock-small"},o.a.createElement("div",{className:"rock-1"}),o.a.createElement("div",{className:"rock-2"}),o.a.createElement("div",{className:"rock-3"}),o.a.createElement("div",{className:"rock-4"}))),o.a.createElement("div",{className:"smoke-container"},o.a.createElement("svg",null,o.a.createElement("path",{d:"M 150 0 Q 200 100 100 250 C 0 450 120 400 50 600  "})),o.a.createElement("div",{className:"fire-container"},o.a.createElement("div",{className:"flame-1"}),o.a.createElement("div",{className:"flame-2"}),o.a.createElement("div",{className:"flame-3"}))),o.a.createElement("div",{className:"tree-container-front"},o.a.createElement("div",{className:"tree-1"}),o.a.createElement("div",{className:"tree-2"}),o.a.createElement("div",{className:"tree-3"}),o.a.createElement("div",{className:"tree-4"}),o.a.createElement("div",{className:"tree-5"}),o.a.createElement("div",{className:"tree-6"}),o.a.createElement("div",{className:"tree-7"})))))},B=(a(87),function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).isDrawEnabled=!1,a.prevX=0,a.currX=0,a.prevY=0,a.currY=0,a.color="black",a.lineWidth=10,a.drawMode="draw",a.setColor=a.setColor.bind(Object(m.a)(a)),a.resetCanvas=a.resetCanvas.bind(Object(m.a)(a)),a.sendImage=a.sendImage.bind(Object(m.a)(a)),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.canvas.width=window.innerWidth-20,this.canvas.height=window.innerHeight-100;var t=this.canvas,a=t.offsetLeft,n=t.offsetTop,o=this.colorChooser.offsetHeight;this.canvasContext=this.canvas.getContext("2d"),this.canvas.addEventListener("mousemove",(function(t){e.currX=parseInt(t.clientX-a),e.currY=parseInt(t.clientY-n-o),e.isDrawEnabled&&(e.canvasContext.beginPath(),"draw"===e.drawMode?(e.canvasContext.globalCompositeOperation="source-over",e.canvasContext.strokeStyle=e.color,e.canvasContext.lineWidth=e.lineWidth):(e.canvasContext.globalCompositeOperation="destination-out",e.canvasContext.lineWidth=3*Number(e.lineWidth)),e.canvasContext.moveTo(e.prevX,e.prevY),e.canvasContext.lineTo(e.currX,e.currY),e.canvasContext.lineJoin=e.canvasContext.lineCap="round",e.canvasContext.stroke(),e.prevX=e.currX,e.prevY=e.currY)}),!1),this.canvas.addEventListener("mousedown",(function(t){var a=e.canvas,n=a.offsetLeft,s=a.offsetTop;e.prevX=e.currX=parseInt(t.clientX-n),e.prevY=e.currY=parseInt(t.clientY-s-o),e.isDrawEnabled=!0}),!1),this.canvas.addEventListener("mouseup",(function(t){e.isDrawEnabled=!1}),!1),this.canvas.addEventListener("mouseout",(function(t){e.isDrawEnabled=!1}),!1)}},{key:"setColor",value:function(e){switch(this.drawMode="draw",e.target.className){case"green":this.color="green";break;case"blue":this.color="blue";break;case"red":this.color="red";break;case"yellow":this.color="yellow";break;case"orange":this.color="orange";break;case"white":this.color="white";break;default:this.color="black"}}},{key:"resetCanvas",value:function(){var e=this.canvas,t=e.width,a=e.height;this.canvasContext.fillStyle="white",this.canvasContext.fillRect(0,0,t,a),this.canvasContext.globalCompositeOperation="source-over"}},{key:"getDataImage",value:function(){var e=document.createElement("canvas");return e.width=this.canvas.width,e.height=this.canvas.height,e.getContext("2d").drawImage(this.canvas,0,0),e.toDataURL("image/png")}},{key:"sendImage",value:function(){var e=this.getDataImage();this.props.onSendImage&&this.props.onSendImage(e)}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"free-draw"},o.a.createElement("div",{className:"color-chooser",ref:function(t){return e.colorChooser=t}},o.a.createElement("button",{className:"green",onClick:this.setColor},"Green"),o.a.createElement("button",{className:"blue",onClick:this.setColor},"Blue"),o.a.createElement("button",{className:"red",onClick:this.setColor},"Red"),o.a.createElement("button",{className:"yellow",onClick:this.setColor},"Yellow"),o.a.createElement("button",{className:"orange",onClick:this.setColor},"Orange"),o.a.createElement("button",{className:"black",onClick:this.setColor},"Black"),o.a.createElement("button",{className:"white",onClick:this.setColor},"White"),o.a.createElement("button",{className:"eraser",onClick:function(){return e.drawMode="eraser"}},"Eraser"),o.a.createElement("select",{onChange:function(t){return e.lineWidth=t.target.value}},o.a.createElement("option",{value:"2"},"2"),o.a.createElement("option",{value:"10",selected:!0},"10"),o.a.createElement("option",{value:"20"},"20")),o.a.createElement("button",{className:"clear",onClick:this.resetCanvas},"Reset"),o.a.createElement("button",{className:"send",onClick:this.sendImage},"Send")),o.a.createElement("canvas",{ref:function(t){return e.canvas=t}}))}}]),t}(n.Component)),J=(a(88),function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).onClick=a.onClick.bind(Object(m.a)(a)),a.onChangeFile=a.onChangeFile.bind(Object(m.a)(a)),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"onClick",value:function(){this.input.click()}},{key:"onChangeFile",value:function(e){var t=this,a=e.target.files[0],n=window.prompt("Set image title"),o=new FileReader;o.onload=function(){t.props.onChange&&t.props.onChange({src:o.result,alt:n})},o.readAsDataURL(a)}},{key:"render",value:function(){var e=this,t=this.props.children;return o.a.createElement("button",{className:"upload-file",onClick:this.onClick},o.a.createElement("span",null,t),o.a.createElement("input",{ref:function(t){return e.input=t},type:"file",onChange:this.onChangeFile}))}}]),t}(n.Component)),P=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).logger=new g("App"),a.state={sourceImage:null,sourceAlt:null,image:null,remote:null,user:T.getItem("user"),users:[],masterTool:null},a.socket=f.a.connect(),a.onLoginSuccess=a.onLoginSuccess.bind(Object(m.a)(a)),a.onLogoutSuccess=a.onLogoutSuccess.bind(Object(m.a)(a)),a.setSourceImage=a.setSourceImage.bind(Object(m.a)(a)),a.uploadImage=a.uploadImage.bind(Object(m.a)(a)),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.socket.on("image",(function(t){e.logger.log("Received remote image from user",t.user),e.setState({remoteImage:t.image,remoteUser:t.user})})),this.socket.on("join",(function(t){e.logger.log("New user joined the room",t),e.setState({users:t})})),this.socket.on("leave",(function(t){e.logger.log("An user left the room",t),e.setState({users:t})})),this.state.user&&this.socket.emit("login",this.state.user)}},{key:"onLoginSuccess",value:function(e){T.save("user",e),this.socket.emit("login",e),this.setState({user:e})}},{key:"onLogoutSuccess",value:function(){T.remove("user"),this.socket.emit("logout",this.state.user),this.setState({user:null})}},{key:"setSourceImage",value:function(e){this.setState({sourceImage:e.src,sourceAlt:e.alt})}},{key:"uploadImage",value:function(e){this.logger.log("Uploading image..."),this.socket.emit("upload",{image:e,user:this.state.user})}},{key:"render",value:function(){var e=this,t=this.state,a=t.sourceImage,n=t.sourceAlt,s=t.remoteImage,r=t.remoteUser,i=t.user,c=t.users,l=t.masterTool;return o.a.createElement("div",{className:"App"},o.a.createElement(b,{user:i,onLoginSuccess:this.onLoginSuccess,onLogoutSuccess:this.onLogoutSuccess}),i&&"master"===i.type?o.a.createElement("div",{className:"master-tools"},o.a.createElement("button",{onClick:function(){return e.setState({masterTool:"baldursFateMaps"})}},"Baldur's Gate"),o.a.createElement("button",{onClick:function(){return e.setState({masterTool:"freeDraw",sourceImage:null})}},"Free Draw"),o.a.createElement(J,{onChange:this.setSourceImage},"Upload"),a?o.a.createElement(v,{image:a,alt:n,onSendImage:this.uploadImage}):null,"baldursFateMaps"===l?o.a.createElement(W,{onMapSelected:this.setSourceImage}):null,"freeDraw"===l?o.a.createElement(B,{onSendImage:this.uploadImage}):null):null,i&&"player"===i.type?o.a.createElement("div",{className:"player-tools"},s&&"master"===r.type?o.a.createElement("img",{alt:"Loading map...",src:s}):o.a.createElement(A,null),o.a.createElement(B,{onSendImage:this.uploadImage})):null,c.map((function(e){return s&&r.id===e.id?o.a.createElement("div",{className:"section-".concat(e.id)},o.a.createElement("fieldset",null,o.a.createElement("legend",null,e.id),o.a.createElement("img",{alt:"User image",src:s}))):null})))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(P,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[45,1,2]]]);
//# sourceMappingURL=main.f00133e6.chunk.js.map